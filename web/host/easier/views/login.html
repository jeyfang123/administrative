<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

    <title>北京市朝阳区行政服务中心--个人登录</title>
    <meta name="keywords" content="行政服务">
    <meta name="description" content="朝阳">
    <link href="/hadmin/css/bootstrap.min.css" rel="stylesheet">
    <link href="/hadmin/css/font-awesome.css?v=4.4.0" rel="stylesheet">
    <!-- Sweet Alert -->
    <link href="/hadmin/css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
    <link href="/hadmin/css/animate.css" rel="stylesheet">
    <link href="/hadmin/css/style.css" rel="stylesheet">
    <link href="/hadmin/css/login.css" rel="stylesheet">
    <link rel="stylesheet" href="/easier/css/header.css">
    <link rel="stylesheet" href="/easier/css/footer.css">
    <script>
        if (window.top !== window.self) {
            window.top.location = window.location;
        }
    </script>

</head>

<body class="signin">
    <div class="row wrapper border-bottom white-bg page-heading">
        <div class="col-sm-12">
            <div class="col-sm-4">
                <a href="/easier/index">
                    <img class="col-sm-8 pull-right" src="/easier/img/logo.png" alt="">
                </a>
            </div>
            <div class="col-sm-6">
                <div class="input-group col-sm-7 search-area pull-right">
                    <input type="text" placeholder="请输入服务项目名称" class="input-sm-7 form-control">
                    <span class="input-group-btn">
                                <button type="button" class="btn btn-sm btn-primary"> 搜索</button>
                            </span>
                </div>
            </div>
        </div>
    </div>
    <div class="signinpanel">
        <div class="row">
            <div class="col-sm-12">
                <form class="login-form">
                    <h4 class="no-margins">登录：</h4>
                    <p class="m-t-md">朝阳行政服务中心</p>
                    <input type="text" name="username" class="form-control uname required" placeholder="用户名" />
                    <input type="password" name="password" class="form-control pword m-b required" placeholder="密码" />
                    <label class="error-msg">错误</label>
                    <a href="javascript:;">忘记密码了？</a><a class="user-action" data-id="register" href="javascript:;" style="float: right">注册</a>
                    <button class="btn btn-success btn-block login-btn">登录</button>
                </form>
                <form class="register-form" style="display: none">
                    <h4 class="no-margins">注册：</h4>
                    <p class="m-t-md">朝阳行政服务中心</p>
                    <input type="text" name="username" class="form-control uname required" placeholder="用户名" />
                    <input type="password" name="password" id="password" class="form-control pword m-b required" placeholder="密码" />
                    <input type="password" name="confirm" class="form-control cpword m-b required" placeholder="确认密码" />
                    <a style="float: right" class="user-action" data-id="login" href="javascript:;" >已有账户,登录</a>
                    <label class="error-msg">错误</label>
                    <button class="btn btn-success btn-block register-btn">注册</button>
                </form>
            </div>
        </div>
        <div class="signup-footer">
            <div class="pull-left">

            </div>
        </div>
    </div>
    <div class="col-sm-12" style="text-align: center;background-color: #E7E7E7;padding-top: 35px;padding-bottom: 50px;">
        <div class="foot-main">
            <div class="foot-link">
                <a href="javascript:void(0)" style="line-height:20px;">把本站设为首页</a>
                <span style=" padding-left:12px; padding-right:12px;">|</span>
                <a href="javascript:void(0)">关于北京市朝阳区政务服务网</a>
                <span style=" padding-left:12px; padding-right:12px;">|</span>
                <a href="javascript:void(0)">本站申明</a>
                <span style=" padding-left:12px; padding-right:12px;">|</span>
                <a href="javascript:void(0)">新手指南</a>
                <span style=" padding-left:12px; padding-right:12px;">|</span>
                <a href="javascript:void(0)" target="_blank">联系我们</a>
            </div>
            <div class="foot-phone">
                <img src="/easier/img/phone.png">
            </div>
            <div class="foot-copyright">
                <span style=" padding-right:15px; font-size:13px; line-height:24px; color:#666;">主办单位：北京市人民政府办公厅</span>
                <span style=" padding-right:15px; font-size:13px; line-height:24px; color:#666;">备案：京ICP备123456789号-2</span>
                <span style=" padding-right:15px; font-size:13px; line-height:24px; color:#666;">
		 		            <a href="javascript:void(0)" style="display:inline-block;text-decoration:none;line-height:24px;">
                                <img src="/easier/img/batb.png" style="float:left;">
                                <span style="font-size:13px;margin: 0px 0px 0px 5px;color:#666;">冀公网安备 12346579887465号</span>
                            </a>
		 	            </span>
                <br>
                <span style=" font-size:13px; line-height:24px; color:#666;">中文域名：北京朝阳.政务</span>
                <span style=" font-size:13px; line-height:24px; color:#666;">建议使用1366*768分辨率/IE9.0或以上浏览器访问达到最佳效果</span>
                <div class="foot-political"><a href="javascript:void(0)" target="_blank"><img src="/easier/img/political-logo.png" width="50" height="62"></a></div>
            </div>
        </div>
    </div>
</body>
<!-- 全局js -->
<script src="/hadmin/js/jquery.min.js?v=2.1.4"></script>
<!-- Sweet alert -->
<script src="/hadmin/js/plugins/sweetalert/sweetalert.min.js"></script>
<!-- Jquery Validate -->
<script src="/hadmin/js/plugins/validate/jquery.validate.min.js"></script>
<script src="/hadmin/js/plugins/validate/messages_zh.min.js"></script>
<script src="/plugins/bower_components/cookie/jquery.cookie.min.js"></script>
<script src="/plugins/bower_components/md5/md5.js" type="text/javascript"></script>
<script src="/public/js/public.js"></script>
<script src="/easier/js/model.js"></script>
<script>
    $(function () {
        var storage = window.localStorage;
        console.log(storage.getItem('from'));
        $('.user-action').click(function () {
            var type = $(this).attr('data-id');
            if(type == 'login'){
                $('form.login-form').show();
                $('form.register-form').hide();
            }
            else{
                $('form.login-form').hide();
                $('form.register-form').show();
            }
        });

        function JqValidateLogin() {
            return $('.login-form').validate({
                rules:{
                    username:{
                        required: true,
                        minlength: 2
                    },
                    password:{
                        required: true,
                        minlength: 5
                    },
                },
                messages:{
                    username:{
                        required:  "请输入您的用户名",
                        minlength: "用户名必须两个字符以上"
                    },
                    password:{
                        required: "请输入密码",
                        minlength: "密码长度过短"
                    },
                }
            });
        }
        function JqValidateReg() {
            return $('.register-form').validate({
                rules:{
                    username:{
                        required: true,
                        minlength: 2
                    },
                    password:{
                        required: true,
                        minlength: 5
                    },
                    confirm: {
                        required: true,
                        minlength: 5,
                        equalTo: "#password"
                    },
                },
                messages:{
                    username:{
                        required:  "请输入您的用户名",
                        minlength: "用户名必须两个字符以上"
                    },
                    password:{
                        required: "请输入密码",
                        minlength: "密码长度过短"
                    },
                    confirm: {
                        required:"请再次输入密码",
                        minlength: "密码必须5个字符以上",
                        equalTo: "两次输入的密码不一致"
                    },
                }
            });
        }
        
        $('button.login-btn').click(function (event) {
            var form = $(this).parents('form');
            form.find('.error-msg').hide();
            var username = $.trim(form.find('.uname').val());
            var password = hex_md5($.trim(form.find('.pword').val()));
            if(JqValidateLogin().form()){
                event.preventDefault();
                Model.login({
                    'username':username,
                    'password':password
                },function (res) {
                    if(res.code == CODE_NOT_FOUND){
                        form.find('.error-msg').css('display','inline-block').text('用户名或密码错误');
                    }
                    else{
                        $.cookie('access',res.access,{path:'/easier'});
                        var from = storage.getItem('from');
                        if(from != null){
                            storage.removeItem('from');
                            window.location.href = from;
                        }
                        else{
                            window.location.href = '/easier/index';
                        }
                    }
                })
            }
        });

        $('button.register-btn').click(function (event) {
            var form = $(this).parents('form');
            form.find('.error-msg').hide();
            var username = $.trim(form.find('.uname').val());
            var password = hex_md5($.trim(form.find('.pword').val()));
            if(JqValidateReg().form()){
                event.preventDefault();
                Model.register({
                    'username':username,
                    'password':password
                },function (res) {
                    if(res.code != CODE_SUCCESS){
                        form.find('.error-msg').css('display','inline-block').text(res.msg);
                    }
                    else{
                        $.cookie('access',res.access,{path:'/easier'});
                        window.location.href = '/easier/views/valued.html'
                    }
                })
            }
        });
    })
</script>

</html>
